
<canvas id="screen" width ="800" height="800" onmousemove="getMousePosition(event)" onclick="rotateCluster(event)" style="border:0px solid #000000;">Get a better browser, yo.</canvas>

<script>
/*
    This code is avaliable under GamahCode General Purpose License v1.2.
        You are free to run, study, modify and redistribute unmodified as well as modified versions of this code, but you would be an idiot to do any of those things.
        You also can NOT give any credit to the original creator.
        I don't want anyone to know that I wrote this.
        Redistributions of this code must carry GamahCode License 1.2 or greater.
        Gamah is not personally responsible for any damages measurable or otherwise that result from this code.
*/
    var colors = [
        "#FF0000",
        "#00FF00",
        "#0000FF",
        "#FFFF00",
        "#000000"
    ]

    //initialize client mouse position
    var cX=0;
    var cY=0;
    
    //initialize board
    //size is arbitrary... 15 feels like a good start
    var boardSize = 10;
    var gameBoard = [];

    for (var x = 0; x < boardSize; x++){
        gameBoard[x] = [];
        for (var y = 0; y < boardSize; y++){
            gameBoard[x][y] = [0,0,0];
        }   
    }
    //set random colors
    for (var row = 0; row < gameBoard.length; row ++){
        for (var col = 0; col < gameBoard.length; col ++){
            num = Math.floor(Math.random() * colors.length);
            gameBoard[row][col] = colors[num];
        }

    }

    
    //Draw the board to the canvas
    function drawBoard(){
        var c = document.getElementById("screen");
        var ctx = c.getContext("2d");
        for (var row = 0; row < boardSize; row ++){
            for (var col = 0; col < boardSize; col ++){
                x =(0 + c.width/boardSize * row );
                y =(0 + c.height/boardSize * col );
                w=c.width/boardSize;
                h=c.height/boardSize;
                ctx.fillStyle = '#000000';
                ctx.fillRect(x,y,w,h);
                ctx.fillStyle = gameBoard[row][col];
                ctx.fillRect(x+1,y+1,w-2,h-2);
            }

        }
    }

    //Set current gameboard x/y coords from mouse x/y coords
    function getMousePosition(event){
        var c = document.getElementById("screen");
        var ctx = c.getContext("2d");
        var offset = c.getBoundingClientRect();
        cX = Math.floor((event.clientX - offset.left) /(c.width/boardSize));
        cY = Math.floor((event.clientY - offset.top) /(c.height/boardSize));
    }

    //Process mouse click, rotate the 4 selected panels "clockwise"... quotes for future support of wrapping top/bottom left/right sides of board...
    function rotateCluster(event){
        getMousePosition(event);
        if(cX > 0 && cY > 0){
            var selectedPieces = [
                gameBoard[cX][cY], //bottomright (0)
                gameBoard[cX][cY-1], //topright (1)
                gameBoard[cX-1][cY-1], //topleft (2)
                gameBoard[cX-1][cY] //topright (3)
            ]
            gameBoard[cX][cY] = selectedPieces[1];
            gameBoard[cX][cY-1] = selectedPieces[2];
            gameBoard[cX-1][cY-1] = selectedPieces[3];
            gameBoard[cX-1][cY] = selectedPieces[0];

            checkBlocksToClear();
        }
    }

    function checkBlocksToClear(){
        //bottom right check
        if(
            //bottom right matches one to the right
            gameBoard[cX][cY] == gameBoard[cX + 1][cY] 
            //bottom right matches one to the right and one down
            && gameBoard[cX][cY] == gameBoard[cX + 1][cY + 1]
            //bottom right matches one down
            && gameBoard[cX][cY] == gameBoard[cX][cY + 1]
        ){
            gameBoard[cX + 1][cY] = "#FFFFFF";
            gameBoard[cX][cY] = "#FFFFFF";
            gameBoard[cX + 1][cY + 1] = "#FFFFFF";
            gameBoard[cX][cY + 1] = "#FFFFFF";
        }
        //top right check
        if(
            //top right matches one to the right
            gameBoard[cX][cY-1] == gameBoard[cX+1][cY-1]
            //top right matches one up and one right
            && gameBoard[cX][cY-1] == gameBoard[cX+1][cY-2]
            //top right matches one up
            && gameBoard[cX][cY-1] == gameBoard[cX][cY-2]
        ){
            gameBoard[cX][cY-1] = "#FFFFFF";
            gameBoard[cX+1][cY-1] = "#FFFFFF";
            gameBoard[cX+1][cY-2] = "#FFFFFF";
            gameBoard[cX][cY-2] = "#FFFFFF";
        }
        //top left check
        if(
            //top left matches one to the left
            gameBoard[cX-1][cY-1] == gameBoard[cX-2][cY-1]
            //top left matches one to the left and one up
            && gameBoard[cX-1][cY-1] == gameBoard[cX-2][cY-2]
            //top left matches one up
            && gameBoard[cX-1][cY-1] == gameBoard[cX-1][cY-2]
        ){
            gameBoard[cX-1][cY-1] = "#FFFFFF"
            gameBoard[cX-2][cY-1] = "#FFFFFF"
            gameBoard[cX-2][cY-2] = "#FFFFFF"
            gameBoard[cX-1][cY-2] = "#FFFFFF"
        }
        //bottom left check
        if(
            //bottom left matches one to the left
            gameBoard[cX-1][cY] == gameBoard[cX-2][cY]
            //bottom left matches one to the left and one down
            && gameBoard[cX-1][cY] == gameBoard[cX-2][cY+1]
            //bottom left matches one down
            && gameBoard[cX-1][cY] == gameBoard[cX-1][cY+1]
        ){
            gameBoard[cX-1][cY] = "#FFFFFF"
            gameBoard[cX-2][cY] = "#FFFFFF"
            gameBoard[cX-2][cY-1] = "#FFFFFF"
            gameBoard[cX-1][cY-1] = "#FFFFFF"
        }
        //right check
        if(
            gameBoard[cX][cY] == gameBoard[cX+1][cY]
            && gameBoard[cX][cY-1] == gameBoard[cX+1][cY-1]
        ){
            gameBoard[cX][cY] = "#FFFFFF"
            gameBoard[cX+1][cY] = "#FFFFFF"
            gameBoard[cX][cY-1] = "#FFFFFF"
            gameBoard[cX+1][cY-1] = "#FFFFFF"
        }
        //up check
        if(
            gameBoard[cX1][cY-1] == gameBoard[cX1][cY-2]
            && gameBoard[cX-1][cY-1] == gameBoard[cX-1][cY-2]
        ){
            gameBoard[cX1][cY-1]  = "#FFFFFF"
            gameBoard[cX1][cY-2] = "#FFFFFF"
            gameBoard[cX-1][cY-1] = "#FFFFFF"
            gameBoard[cX-1][cY-2] = "#FFFFFF"
        }
        //left check
        if(
            gameBoard[cX-1][cY] == gameBoard[cX-2][cY]
            && gameBoard[cX-1][cY-1] == gameBoard[cX-2][cY-1]
        ){
            gameBoard[cX-1][cY] = "#FFFFFF"
            gameBoard[cX+2][cY] = "#FFFFFF"
            gameBoard[cX-1][cY-1] = "#FFFFFF"
            gameBoard[cX-2][cY-1] = "#FFFFFF"
        }
        //down check
        if(
            gameBoard[cX][cY] == gameBoard[cX][cY+1]
            && gameBoard[cX-1][cY] == gameBoard[cX-1][cY+1]
        ){
            gameBoard[cX][cY] = "#FFFFFF"
            gameBoard[cX][cY+1] = "#FFFFFF"
            gameBoard[cX-1][cY] = "#FFFFFF"
            gameBoard[cX-1][cY+1] = "#FFFFFF"
        }
        
    }

    function drawSelection(){
        var c = document.getElementById("screen");
        var ctx = c.getContext("2d");
        if(cX > 0 && cY > 0){
            x =(0 + c.width/boardSize * (cX - 1));
            y =(0 + c.height/boardSize * (cY - 1));
            w=(c.width/boardSize) * 2;
            h=(c.height/boardSize) * 2;
            ctx.strokeStyle = '#FFFFFF';
            ctx.lineWidth = 4;
            ctx.strokeRect(x,y,w,h);
        }                

    }

    setInterval(function(){
        drawBoard();
        drawSelection();
        console.log(cX + ", " + cY);
    }, 5);


</script>